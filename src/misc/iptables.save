# Default
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT DROP [0:0]

# Loopback (localhost) incoming
-A INPUT -i lo -j ACCEPT
# Already existing connections
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
# Pings incoming
-A INPUT -p icmp -j ACCEPT
# SSH for remote support.
# TODO: Specify several sources for security while maintaining recovery ability
# or disable password login completely.
-A INPUT -p tcp -m tcp --dport 22 -j ACCEPT
# Kerberos. TODO: Specify source for security. Beware of spoofing.
# Incoming connections are still a method for communicating with outsiders, although one-way.
-A INPUT -p tcp -m tcp --dport 88 -j ACCEPT
# Internal services
-A INPUT -p tcp -m tcp -s {SUBNET} --dport 10050 -j ACCEPT
-A INPUT -p tcp -m tcp -s {SUBNET} --dport 9090 -j ACCEPT

# Loopback (localhost) outgoing
-A OUTPUT -o lo -j ACCEPT
# Already existing connections
-A OUTPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
# Pings outgoing
-A OUTPUT -p icmp -j ACCEPT
# Tinc outgoing. Restricted to central server at the address "vpn.vnoi". Specified in /etc/hosts.
-A OUTPUT -p tcp -m tcp -d vpn.vnoi --dport 655 -j ACCEPT
-A OUTPUT -p udp -m udp -d vpn.vnoi --dport 655 -j ACCEPT
# DNS resolver. Restricted to servers managed by Google and Cloudflare (should be enough).
-A OUTPUT -p tcp -m tcp --dport 53 -d 8.8.8.8,8.8.8.4,1.1.1.1,1.0.0.1 -j ACCEPT
-A OUTPUT -p udp -m udp --dport 53 -d 8.8.8.8,8.8.8.4,1.1.1.1,1.0.0.1 -j ACCEPT
# NTP, time sync. Restricted to ntp.ubuntu.com (Ubuntu's default), time.windows.com, time.nist.gov (Windows's choices)
-A OUTPUT -p udp -m udp --dport 123 -d ntp.ubuntu.com,time.windows.com,time.nist.gov -j ACCEPT
# Internal services
-A OUTPUT -p tcp -m tcp -m multiport -d {SUBNET} --dports 22,80,443,8000:9000 -j ACCEPT
# User portal. Restricted to webserver's domain. TODO: Consider placing in /etc/hosts.
-A OUTPUT -p tcp -m tcp -m multiport -d {WEBSERVER_PUBLIC_DOMAIN} --dports 80,443 -j ACCEPT
# Authentication. TODO: Consider placing in /etc/hosts.
-A OUTPUT -p tcp -m tcp -m multiport -d {AUTH_ADDRESS} --dports 80,443,88,749,464,445,135,389 -j ACCEPT
-A OUTPUT -p udp -m udp -m multiport -d {AUTH_ADDRESS} --dports 88,4444,464,53,389 -j ACCEPT
# External resources. Will be enabled on a case-by-case basis.
-A OUTPUT -p tcp -m multiport -d fonts.gstatic.com --dports 80,443 -j ACCEPT
-A OUTPUT -p tcp -m multiport -d gravatar.com --dports 80,443 -j ACCEPT
-A OUTPUT -p tcp -m multiport -d cdnjs.cloudflare.com --dports 80,443 -j ACCEPT
COMMIT
